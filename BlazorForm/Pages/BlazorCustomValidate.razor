@page "/custom"
@using System.ComponentModel.DataAnnotations

<h3>カスタム検証を利用する</h3>

<EditForm Model="addressModel" OnValidSubmit="onValidSubmit">
    <DataAnnotationsValidator></DataAnnotationsValidator>
    <CustomValidator @ref="customValidator"></CustomValidator>

    <div class="form-group">
        <label for="zipcode">郵便番号</label>
        <InputText id="zipcode" @bind-Value="addressModel.zipCode" class="form-control"></InputText>
    </div>
    <div class="form-group">
        <label for="prefecture">都道府県</label>
        <InputSelect id="prefecture" @bind-Value="addressModel.prefecture" class="form-control">
            @foreach (var it in prefectures)
            {
                <option>@it</option>
            }
        </InputSelect>
    </div>
    <div class="form-group">
        <label for="name">名前</label>
        <InputText id="name" @bind-Value="addressModel.name" class="form-control"></InputText>
    </div>
    <div class="form-group">
        <label for="age">年齢</label>
        <InputNumber id="age" @bind-Value="addressModel.age" class="form-control"></InputNumber>
    </div>
    <div class="form-group">
        <div>訪問日</div>
        <div class="form-check form-check-inline">
            <InputCheckbox id="boolvisit" @bind-Value="addressModel.isVisitDate" class="form-check-input"></InputCheckbox>
            <label class="form-check-label" for="boolvisit">訪問を希望する</label>
        </div>
        <InputDate id="visit" @bind-Value="addressModel.visitDate" class="form-control"></InputDate>
    </div>
    <button class="btn btn-primary" type="submit">登録</button>
    <div style="margin-top: 20px">
        @Message
    </div>

</EditForm>

@code {

    public class Address
    {
        public string zipCode { get; set; }
        public string prefecture { get; set; }
        public string telephone { get; set; }
        public string name { get; set; }
        public int age { get; set; }
        public bool isVisitDate { get; set; }
        public DateTime? visitDate { get; set; }
    }

    private CustomValidator customValidator;
    private Address addressModel = new Address();
    private string Message { get; set; }
    private void onValidSubmit()
    {
        customValidator.ClearErrors();
        var errors = new Dictionary<string, List<string>>();
        if (addressModel.isVisitDate == true)
        {
            if (addressModel.visitDate == null)
            {
                errors.Add("visitDate", new List<string>()
                {
                    "訪問日を入力してください"
                });
            }
            else if (addressModel.visitDate < DateTime.Today)
            {
                errors.Add("visitDate", new List<string>()
                {
                    "過去の訪問日は指定できません"
                });
            }
        }

        if (errors.Count > 0)
        {
            customValidator.DisplayErrors(errors);
        }
        else
        {
            Message = addressModel.name + "さん、登録ありがとうございました.";
        }
    }

    private string[] prefectures = new string[] {
        "北海道",
        "青森県",
        "岩手県"
    };
}
